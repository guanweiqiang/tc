# TechCommunity（tc）

## 项目简介

TechCommunity 是一个基于 **Spring Boot 的单体后端 Demo 项目**，以社区业务为载体，重点实践后端系统中常见的工程问题，包括：认证与登录态管理、缓存设计、异步处理、搜索能力引入以及工程化规范。  
项目关注 **技术选型的合理性与可解释性**，而非功能复杂度或技术堆叠。

---

## 技术栈

- **Spring Boot 3.5**：Web 框架与工程基础设施
- **MySQL 5.7**：核心业务数据存储
- **Redis Stack 7.4.0**：缓存、计数、登录态管理
- **RabbitMQ 4.2.2**：异步任务处理与批量写优化
- **Elasticsearch 9.2.1**：搜索与全文检索

选型原则：技术成熟、职责清晰，覆盖真实后端高频场景，避免不必要的系统复杂度。

---

## 系统架构与分层

项目采用 **单体架构 + 清晰分层** 的设计：

- **Controller**：REST API，参数校验与请求分发
- **Service**：业务逻辑编排、事务控制、缓存 / MQ / ES 协调
- **Mapper**：MyBatis 数据访问层
- **Interceptor**：鉴权与请求上下文处理
- **Common**：统一异常、校验、通用工具类

整体设计强调职责单一、低耦合和可维护性。

---

## 认证与登录态管理

### 设计目标
- 无 Session 依赖
- 支持单点登录（同一账号仅保留一个有效会话）
- 登录态可由服务端主动控制并立即失效

### 实现方案：JWT + Redis

- JWT 仅用于身份标识
- Redis 作为登录态唯一权威存储

登录成功后生成包含 `userId` 与 `jti` 的 JWT，并在 Redis 中维护：
`login:active:{userId} -> jti`
每次请求同时校验 JWT 与 Redis 中的 `jti`，新登录会覆盖旧记录，从而使旧会话失效。  
Logout 通过删除 Redis 登录态实现即时生效。

---

## 缓存设计与一致性策略

### 使用场景
- 热点业务数据缓存
- 点赞 / 收藏等高频读写场景
- 登录态与权限校验

### 一致性处理
- 数据库作为最终数据源
- 写操作优先落库，缓存更新或失效
- 对允许短暂不一致的场景采用 **最终一致性**

同时针对缓存穿透、击穿与雪崩问题，结合参数校验、热点控制与过期时间打散进行防护。

---

## 异步处理与消息队列设计（RabbitMQ）

### 使用目的（明确边界）

RabbitMQ 在本项目中主要用于以下场景：

1. **异步发送邮件**
    - 将邮件发送从核心业务流程中解耦
    - 避免外部 I/O 操作阻塞主线程
    - 提升接口响应速度

2. **定时刷库与批处理写入**
    - 将高频写操作在 Redis 中进行暂存
    - 通过定时任务或异步消费进行批量落库
    - 减少数据库压力，规避 N+1 次写操作问题

### 设计要点
- 使用 ACK 机制保证消息可靠消费
- 通过业务幂等控制处理重复消费
- 消费失败记录日志，并结合重试或补偿机制处理

---

## 搜索系统设计（Elasticsearch）

### 使用目的
Elasticsearch 在本项目中 **仅用于搜索与检索场景**，主要解决：

- 模糊搜索性能问题
- 全文检索需求
- 复杂查询条件下的响应效率问题

### 使用原则
- Elasticsearch 不承担主数据存储职责
- MySQL 作为最终数据源
- ES 索引通过异步或定时方式与数据库同步
- 接受短暂不一致，必要时支持索引重建

---

## 工程化设计

- **统一异常处理**：集中管理系统异常与业务异常
- **参数校验**：在 Controller 层进行请求合法性校验
- **拦截器机制**：统一处理认证与请求上下文注入

---

## 总结

本项目在单体架构下，对后端系统中常见的工程问题进行了实践，并通过明确职责边界与技术取舍，在 **复杂度、性能与可维护性** 之间取得平衡。  
设计重点在于工程合理性与稳定性，而非技术数量或形式上的复杂。
